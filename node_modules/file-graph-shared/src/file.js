const $ = require('jquery');
const _ = require('lodash');

const ListenableObject = require('./listenable-object');

class File extends ListenableObject {
    constructor(path, name, tags = []) {
        super();
        this.path = path;
        this.name = name;
        this.tags = tags;
    }

    getId() {
        return this.path + '/' + this.name;
    }

    save() {
        return new Promise((res, rej) => {
            $.ajax({
                type: 'POST',
                url: `/file?file=${JSON.stringify(this.toJSON())}`,
                dataType: 'json',
                success: res,
                contentType: 'application/json'
            });
        })
            .then(data => this.emitEvent('updated', data));
    }

    static fromJSON(json) {
        return new File(json.path, json.name, json.tags);
    }

    toJSON() {
        return _.pick(this, ['path', 'name', 'tags']);
    }
}

module.exports = File;